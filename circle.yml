machine:
    services:
        - docker

dependencies:
    override:
        - go get -v -d ./...

test:
    override:
        - CGO_ENABLED=0 GOOS=linux go build -ldflags "-s" -a -installsuffix cgo
        - cp gitcat $CIRCLE_ARTIFACTS/

deployment:
    release:
        tag: /[0-9]+(\.[0-9]+){2}/
        commands:
            - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
            - docker build -t surycat/gitcat:latest .
            - docker tag surycat/gitcat:latest surycat/gitcat:$CIRCLE_TAG
            - docker push surycat/gitcat:latest
            - docker push surycat/gitcat:$CIRCLE_TAG
